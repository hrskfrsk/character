(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[623],{4438:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/character/preview",function(){return a(6169)}])},6169:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var s=a(5893),r=a(7294),c=a(9008),n=a.n(c),i=a(1163),o=a(109),l=a(7865),d=a(5279),u=a(1917),h=a(9141),m=a(5012),p=a(6103),x=a(4094),f=a(1285),g=a(6634),j=a(9373),b=a(6875),w=a(2210);function _(){let e=(0,i.useRouter)(),[t,a]=(0,r.useState)(null),[c,_]=(0,r.useState)(!1),[y,v]=(0,r.useState)({}),[k,N]=(0,r.useState)({}),[S,E]=(0,r.useState)(null),[C,P]=(0,r.useState)(!1),I=(e,t)=>{let a=e.replace("#",""),s=parseInt(a.substring(0,2),16),r=parseInt(a.substring(2,4),16),c=parseInt(a.substring(4,6),16),n=e=>Math.round(e).toString(16).padStart(2,"0");return"#".concat(n(Math.max(0,Math.min(255,s+s*t/100)))).concat(n(Math.max(0,Math.min(255,r+r*t/100)))).concat(n(Math.max(0,Math.min(255,c+c*t/100))))},M=(e,t)=>{let a=e.replace("#",""),s=parseInt(a.substring(0,2),16),r=parseInt(a.substring(2,4),16),c=parseInt(a.substring(4,6),16);return"rgba(".concat(s,", ").concat(r,", ").concat(c,", ").concat(t,")")},[Z,T]=(0,r.useState)({weapons:!1,items:!1,disorders:!1,books:!1,spells:!1,artifacts:!1,entities:!1,memos:!1}),[q,A]=(0,r.useState)(!0),[B,D]=(0,r.useState)(!1),z=(e,t)=>{E((0,u.G)(e,t))},F=e=>{T(t=>({...t,[e]:!t[e]}))},O=async()=>{if(t){P(!0);try{if(!l.db){console.error("Firebase not initialized"),alert("データベースに接続できません");return}if(!t.character_name||""===t.character_name.trim()){alert("キャラクター名を入力してください");return}let a="";if(t.id){let e={...t,updatedAt:new Date};delete e.id;let s=(0,o.JU)(l.db,"characters",t.id);await (0,o.r7)(s,e),a=t.id,alert("キャラクターが更新されました！")}else{let e={...t,createdAt:new Date,updatedAt:new Date};a=(await (0,o.ET)((0,o.hJ)(l.db,"characters"),e)).id,alert("キャラクターが保存されました！")}e.push("/character/".concat(a))}catch(e){console.error("保存エラー:",e),alert("保存に失敗しました")}finally{P(!1)}}};if((0,r.useEffect)(()=>{if(null==t?void 0:t.ui_theme_color){let e=t.ui_theme_color,a=I(e,-20),s=M(e,.15),r=M(e,.4),c=M(e,.7);document.documentElement.style.setProperty("--ui-theme-color",e),document.documentElement.style.setProperty("--ui-theme-color-hover",a),document.documentElement.style.setProperty("--ui-theme-color-light",s),document.documentElement.style.setProperty("--ui-theme-color-medium",r),document.documentElement.style.setProperty("--ui-theme-color-dark",c)}},[null==t?void 0:t.ui_theme_color]),(0,r.useEffect)(()=>{_(!0);{let t=localStorage.getItem("tempCharacter");if(t)try{let e=JSON.parse(t);a(e)}catch(t){console.error("Failed to parse temp character:",t),e.push("/")}else e.push("/")}},[e]),!t)return(0,s.jsxs)("div",{children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:"プレビュー読み込み中"})}),(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"18px",color:"#666"},children:"プレビューを読み込み中..."})]});let J="".concat(t.character_name||"キャラクター"," - プレビュー");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:J}),(0,s.jsx)("meta",{name:"description",content:"".concat(t.character_name,"のキャラクターシートプレビュー")}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,s.jsx)(b.Z,{showBackButton:!1,showCreateButton:!1,actionButtons:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{type:"button",className:"nav-link",style:{background:"#74cdc3",border:"none",cursor:"pointer"},disabled:C,onClick:O,onMouseEnter:e=>{e.currentTarget.style.background="#5fb5aa"},onMouseLeave:e=>{e.currentTarget.style.background="#74cdc3"},children:[(0,s.jsx)("i",{className:"fas fa-save"}),(0,s.jsx)("span",{className:"nav-text",children:C?"保存中...":"保存"})]}),(0,s.jsxs)("button",{type:"button",className:"nav-link",style:{border:"none",cursor:"pointer"},onClick:()=>window.close(),children:[(0,s.jsx)("i",{className:"fas fa-times"}),(0,s.jsx)("span",{className:"nav-text",children:"閉じる"})]})]})}),(0,s.jsx)("div",{className:"works-template-default single single-works postid-6531 custom-background",children:(0,s.jsx)("div",{id:"content",className:"chara-coc character page-with-header ".concat((null==t?void 0:t.is_lost)?"is-lost":""),children:(0,s.jsx)("div",{id:"inner-content",className:"wrap cf",children:(0,s.jsx)("main",{id:"main",role:"main",itemScope:!0,itemProp:"mainContentOfPage",itemType:"http://schema.org/Blog",children:(0,s.jsxs)("article",{id:"post-6531",className:"cf post-6531 works type-works status-publish has-post-thumbnail hentry custom_cat-character custom_cat-chara-coc custom_tag-1072",role:"article",children:[(0,s.jsxs)("div",{style:{background:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:"4px",padding:"10px",margin:"10px 0",textAlign:"center",fontSize:"14px",color:"#856404"},children:[(0,s.jsx)("i",{className:"fas fa-exclamation-triangle"})," これはプレビューです。保存されていない変更内容が含まれています。"]}),(0,s.jsx)(g.Z,{character:t}),(0,s.jsx)("section",{className:"chara-seet character-display",children:(0,s.jsxs)("div",{className:"data-wrap",style:{margin:"10px 0"},children:[(0,s.jsxs)("div",{className:"playsheet-header ".concat(B?"":"active"),onClick:()=>D(!B),children:[(0,s.jsxs)("h2",{children:[(0,s.jsx)("i",{className:"fas fa-scroll section-icon"})," Character Sheet"]}),(0,s.jsx)("i",{className:"fas ".concat(B?"fa-chevron-right":"fa-chevron-down"),style:{marginRight:"5px"}})]}),!B&&(0,s.jsxs)("div",{className:"equipment-content",children:[(0,s.jsx)(h.Z,{character:t,calculateAbilityTotal:()=>["str_total","con_total","pow_total","dex_total","app_total","siz_total","int_total","edu_total"].reduce((e,a)=>{let s=t[a];return e+(s&&!isNaN(s)?parseInt(s):0)},0)}),(0,s.jsxs)("div",{className:"character-info character-name-section",children:[(0,s.jsx)(p.Z,{character:t}),(0,s.jsx)(f.Z,{character:t,characterId:"preview",handleSkillClick:z,onCcfoliaExport:()=>{}}),(0,s.jsx)(m.Z,{character:t,equipmentSections:Z,toggleEquipmentSection:F,handleSkillClick:z}),(0,s.jsx)(x.Z,{character:t,equipmentSections:Z,toggleEquipmentSection:F,secretMemoVisibility:y,memoPasswordStates:k,toggleSecretMemoVisibility:e=>{v(t=>({...t,[e]:!t[e]}))},handlePasswordInput:(e,t)=>{N(a=>({...a,[e]:{...a[e],inputPassword:t}}))},handlePasswordSubmit:e=>{var a;let s=t["".concat(e,"_password")];((null===(a=k[e])||void 0===a?void 0:a.inputPassword)||"")===s?N(t=>({...t,[e]:{...t[e],unlocked:!0}})):alert("パスワードが正しくありません")}})]})]})]})}),(0,s.jsx)(j.Z,{characterData:t}),(0,s.jsx)(j.x,{characterData:t})]})})})})}),(0,s.jsx)(d.Z,{result:S,onClose:()=>E(null)}),(0,s.jsx)(w.Z,{})]})}}},function(e){e.O(0,[930,534,125,888,774,179],function(){return e(e.s=4438)}),_N_E=e.O()}]);