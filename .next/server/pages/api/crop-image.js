"use strict";(()=>{var e={};e.id=979,e.ids=[979],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6697:(e,t,r)=>{r.r(t),r.d(t,{config:()=>h,default:()=>d,routeModule:()=>f});var a={};r.r(a),r.d(a,{default:()=>l});var o=r(1802),i=r(7153),n=r(6249);let s=require("sharp");var u=r.n(s);async function l(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{imageUrl:r,cropData:a}=e.body;if(console.log("Crop request:",{imageUrl:r,cropData:a}),!r||!a)return t.status(400).json({error:"imageUrl and cropData are required"});let{x:o,y:i,width:n,height:s}=a,l=await fetch(r);if(!l.ok)throw Error(`Failed to fetch image: ${l.status}`);let d=await l.arrayBuffer();console.log("Image buffer size:",d.byteLength);let h=await u()(Buffer.from(d)).metadata();console.log("Image metadata:",h);let f=Math.max(0,Math.min(Math.round(o),(h.width||0)-1)),g=Math.max(0,Math.min(Math.round(i),(h.height||0)-1)),c=Math.max(1,Math.min(Math.round(n),(h.width||0)-f)),m=Math.max(1,Math.min(Math.round(s),(h.height||0)-g));console.log("Crop parameters:",{original:{x:o,y:i,width:n,height:s},safe:{x:f,y:g,width:c,height:m},imageSize:{width:h.width,height:h.height}});let p=await u()(Buffer.from(d)).extract({left:f,top:g,width:c,height:m}).resize(128,128,{fit:"cover",position:"center"}).jpeg({quality:80}).toBuffer();console.log("Cropped buffer size:",p.length);let P=`data:image/jpeg;base64,${p.toString("base64")}`;t.status(200).json({croppedImage:P})}catch(e){console.error("Image crop error:",e),t.status(500).json({error:"Failed to crop image",details:e instanceof Error?e.message:"Unknown error"})}}let d=(0,n.l)(a,"default"),h=(0,n.l)(a,"config"),f=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/crop-image",pathname:"/api/crop-image",bundlePath:"",filename:""},userland:a})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6697);module.exports=r})();